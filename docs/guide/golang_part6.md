---
outline: deep
prev:
  text: 'web框架和rpc框架'
  link: '/guide/golang_part5'
---
> 这里简要总概括，具体参见

- https://xiaolincoding.com/mysql/
- https://xiaolincoding.com/redis/

## Mysql

### 1. **OLTP** **与** **OLAP** 

- **OLTP****(在线事务处理)** ：用于支持大量的短期、原子性操作（如插入、更新、删除）。典型场景包括银行系统、订单系统等，要求高并发、快速响应和数据一致性。
- **OLAP****(在线分析处理)**：主要用于数据分析，处理较大的数据集和复杂的查询操作，适合数据仓库等应用场景。OLAP查询通常是多维度的，涉及聚合、分组等操作。

### 2. **MySQL****体系结构**

MySQL的体系结构分为多个层次，主要包括：

- **连接管理与安全**：负责处理用户连接、身份验证和连接池管理。
- **查询解析与优化**：包括SQL解析器、查询优化器、执行计划生成器等。
- **存储引擎**：MySQL支持多种存储引擎（如InnoDB、MyISAM等），不同引擎有不同的特性，如事务支持、表锁还是行锁等。

### 3. **MySQL****网络模块**

- **连接池**：用于管理与数据库服务器的连接，减少频繁建立连接的开销，提高性能。连接池可以复用创建的连接，尤其在高并发场景下表现尤为显著。
- **事务**：事务是数据库执行中的一个逻辑单元，MySQL通过事务保证数据一致性，支持ACID特性（原子性、一致性、隔离性、持久性）。

### 4.**CRUD**

- **表的创建与删除**：使用SQL语句`CREATE TABLE`创建表，定义表的列、数据类型、约束等。`DROP TABLE`用于删除表。
- **CRUD****操作**： 
  - **C**：Create，用`INSERT`语句插入数据。
  - **R**：Read，用`SELECT`查询数据。
  - **U**：Update，用`UPDATE`修改数据。
  - **D**：Delete，用`DELETE`删除数据。

### 5. **聚合查询、分组查询、联表查询**

- **聚合查询**：通过聚合函数（如`SUM()`、`COUNT()`、`AVG()`等）对一组数据进行计算。
- **分组查询**：使用`GROUP BY`对查询结果进行分组，常用于与聚合函数结合使用。
- **联表查询**：通过`JOIN`语句连接多张表，常见的连接类型包括`INNER JOIN`、`LEFT JOIN`、`RIGHT JOIN`等，解决多表相关联的数据查询问题。

### 6. **索引**

- **主键****索引**：主键是表中唯一标识每一行的字段，且不能为NULL。MySQL会自动为主键字段创建索引。
- **唯一索引**：保证某列的值在表中唯一，类似于主键但允许NULL值。
- **普通索引**：不强制唯一性，主要用于加速查询。
- **组合索引**：由多个列组合形成的索引，优化多条件查询。
- **索引与约束**：索引用于加速查询，约束用于保证数据的完整性（如外键约束、唯一约束等）。
- **B+树**：MySQL中的InnoDB存储引擎使用B+树作为索引的存储结构，B+树是一种平衡树，适合处理范围查询。
- **最左匹配原则**：对于组合索引，查询时必须按照索引从左到右的顺序进行匹配，才能有效利用索引。
- **覆盖索引**：如果查询的字段都在索引中，则无需访问表数据，直接从索引中返回结果，提高查询效率。

### 7. **索引失效、索引优化、****SQL****优化、explain分析、慢查询日志**

- **索引失效**：在某些情况下，MySQL无法利用索引（如在索引列上使用函数、类型不匹配、不符合最左前缀原则等）。
- **索引优化**：合理设计索引，避免冗余索引，使用组合索引减少查询次数，避免全表扫描。
- **SQL****优化**：通过减少不必要的字段查询、避免复杂的子查询、使用合适的索引等来优化SQL语句。
- **Explain分析**：使用`EXPLAIN`查看SQL执行计划，分析查询是否使用了索引、表扫描的顺序等信息。
- **慢查询日志**：记录执行时间较长的SQL查询，帮助开发者找出性能瓶颈。

### 8. **事务控制语句、事务的****ACID****特性、事务的隔离级别**

- **事务控制语句**：包括`START TRANSACTION`、`COMMIT`、`ROLLBACK`等，用于控制事务的开始、提交和回滚。
- **ACID****特性**： 
  - **原子性**：事务中的操作要么全部执行，要么全部回滚。
  - **一致性**：事务执行前后，数据库处于一致的状态。
  - **隔离性**：并发事务之间相互隔离，避免相互干扰。
  - **持久性**：事务提交后，数据即使在系统崩溃后也能保持持久保存。
- **事务的隔离级别**： 
  - **读未提交**：一个事务可以读取另一个未提交事务的数据，可能导致脏读。
  - **读已提交**：只能读取已经提交的数据，避免脏读，但可能出现不可重复读。
  - **可重复读**：一个事务在读取数据后，其他事务不能修改该数据，避免不可重复读。
  - **串行化**：最高隔离级别，事务完全串行执行，避免幻读，但性能较低。

### 9. **加锁流程、释放锁流程、****MVCC****原理、当前读与快照读、读异常**

- **加锁流程与释放锁流程**：MySQL中的InnoDB引擎支持行级锁和表级锁，事务在操作数据时会加锁以保证数据一致性。事务结束后（提交或回滚），锁会被释放。
- **MVCC****（****多版本并发控制****）**：通过保存数据的多个版本，允许读写操作并发执行，减少锁竞争。MVCC主要用于实现事务的隔离性。
- **当前读与快照读**： 
  - **当前读**：读取最新的数据，同时对数据加锁，防止其他事务修改。
  - **快照读**：读取数据的历史快照，避免加锁，适用于高并发环境。
- **读异常**：指并发事务导致的数据不一致现象，如脏读、不可重复读、幻读等。

### 10. **死锁****原理与案例分析**

- **死锁**：在并发环境中，多个事务持有锁并等待对方释放锁，形成循环等待，导致事务无法继续执行。
- **死锁****解决方案**： 
  - MySQL会自动检测到死锁并回滚其中一个事务。
  - 通过合理设计加锁顺序和减少事务的锁定范围，可以有效减少死锁的发生。

## Redis

Redis 是一个开源的、基于内存的数据结构存储系统，支持多种数据结构（如字符串、列表、集合、有序集合、哈希表等）。其核心是高效的内存管理，通过内存存储数据，并提供持久化的选项（RDB 和 AOF）。Redis 采用单线程模型，但由于其基于内存操作性能极高，在处理高并发请求时非常有优势。

Redis 存储的数据类型主要包括：

- **String（字符串）**
- **List（列表）**
- **Hash（哈希）**
- **Set（集合）**
- **ZSet（****有序集合****）**

### 1. **String 命令及内部存储原理**

#### String 对象存储原理

String 是 Redis 中最基本的数据类型，可以存储普通字符串、整数或浮点数。内部存储结构为 `SDS`（Simple Dynamic String），是一种动态字符串结构，支持字符串的自动扩展与缩减。SDS 具备以下特点：

- **字符串长度动态扩展**：通过预分配空间，减少多次重新分配内存的开销。
- **二进制安全**：SDS 支持二进制数据，可以存储任意字节数据。

#### String 常用命令

- `SET key value`：设置指定 key 的值。
- `GET key`：获取 key 对应的值。
- `INCR key`：对 key 的值进行累加操作。
- `APPEND key value`：将 value 追加到 key 的值末尾。
- `SETNX key value`：当 key 不存在时，设置 key 的值。

#### String 应用场景

1. **String** **累加器****应用**：可以使用 `INCR` 和 `DECR` 实现计数器功能，常用于文章阅读量、点赞数等。
2. **String** **分布式锁**：通过 `SETNX` 和 `EXPIRE` 实现简单的分布式锁，当一个 key 不存在时，设置该 key，同时设置过期时间，防止死锁。
3. **String** **位运算****应用**：Redis 支持对字符串进行位运算，如 `BITOP`，可以实现位图（bitmap）操作，适用于用户签到、活跃用户统计等场景。

### 2. **List 命令及内部存储原理**

#### List 对象存储原理

Redis 的 List 是一个双向链表，底层实现为 `quicklist`，支持从两端快速插入和删除操作。List 可以存储有序的字符串元素，并根据需要扩展存储。

#### List 常用命令

- `LPUSH key value`：将 value 插入到列表的左边。
- `RPUSH key value`：将 value 插入到列表的右边。
- `LPOP key`：从列表的左边弹出一个元素。
- `RPOP key`：从列表的右边弹出一个元素。
- `LRANGE key start stop`：获取列表指定范围内的元素。

#### List 应用场景

1. **List 栈应用**：可以使用 `LPUSH` 和 `LPOP` 实现栈（后进先出）的操作。
2. **List 队列应用**：可以使用 `RPUSH` 和 `LPOP` 实现队列（先进先出）的操作。
3. **List 步队列**：可以通过 `RPUSH` 和 `RPOP` 实现步队列，适合用于任务调度场景。
4. **List 阻塞队列**：通过 `BLPOP` 或 `BRPOP` 实现阻塞队列，应用场景包括消息队列模型，当队列为空时，命令会阻塞直到有数据可读。
5. **List 固定窗口记录**：可以通过 `LPUSH` 并结合 `LTRIM` 命令实现固定窗口，记录一定数量的历史数据（如最近的100条请求记录）。

### 3. **Hash 命令及内部存储原理**

#### Hash 对象存储原理

Hash 是 Redis 中的哈希表结构，类似于 `key-value` 的子对象集合，可以在一个 key 下存储多个字段。底层实现为哈希表（hash table）或 `ziplist`（压缩列表）形式，具体取决于哈希表的大小。

#### Hash 常用命令

- `HSET key field value`：设置哈希表中字段的值。
- `HGET key field`：获取哈希表中字段的值。
- `HDEL key field`：删除哈希表中的某个字段。
- `HGETALL key`：获取哈希表中所有字段和值。

#### Hash 应用场景

1. **对象存储**：适合存储用户信息、商品信息等对象数据，使用 `hash` 可以将对象的不同属性作为字段存储，实现紧凑存储。
2. **局部更新**：Hash 支持对单独字段进行操作，适合需要频繁更新部分字段的场景。

### 4. **Set 命令及内部存储原理**

#### Set 对象存储原理

Set 是一个无序的集合，集合中的元素是唯一的，底层使用哈希表实现。Redis 的 Set 提供了集合运算的支持，如交集、并集、差集等。

#### Set 常用命令

- `SADD key member`：向集合中添加元素。
- `SREM key member`：从集合中移除元素。
- `SMEMBERS key`：获取集合的所有成员。
- `SINTER key1 key2`：获取多个集合的交集。

#### Set 应用场景

1. **唯一无序数据存储**：适用于存储不重复的数据，如用户ID集合、标签数据等。
2. **Set** **关系运算**：可以利用 `SINTER`、`SUNION` 等命令实现交集、并集和差集的计算，常用于推荐系统或权限管理。

### 5. **ZSet 命令及内部存储原理**

#### ZSet 对象存储原理

ZSet（有序集合）类似于 Set，但每个元素关联了一个分数，ZSet 会根据分数自动排序。它的底层实现为跳表（SkipList），能够高效地进行范围查询。

#### ZSet 常用命令

- `ZADD key score member`：添加元素及其分数。
- `ZRANGE key start stop`：按分数从低到高获取指定范围内的元素。
- `ZREM key member`：移除指定元素。
- `ZRANK key member`：获取指定元素的排名。

#### ZSet 应用场景

1. **排行榜应用**：ZSet 可以用于实现排行榜，按分数对元素进行排序，适合游戏排行榜、用户积分排名等场景。
2. **延迟队列**：通过将任务的执行时间作为分数，使用 `ZADD` 存入任务队列，并通过 `ZRANGEBYSCORE` 获取到期的任务，实现延迟队列。
3. **时间窗口限流**：将请求的时间戳作为分数，使用 ZSet 排好序后，根据时间窗口内的请求数来限流。

### 6. **Redigo 操作、管道和事务、订阅发布、Stream**

#### Redigo 基本操作

Redigo 是 Go 语言的 Redis 客户端，提供了与 Redis 服务器进行通信的接口。主要操作包括：

- `conn.Do(command, args...)`：执行 Redis 命令。
- `conn.Send(command, args...)`：发送 Redis 命令，适用于管道操作。

#### Redigo 管道和事务

- **管道**：通过 `Send` 和 `Flush` 方法，Redigo 实现了 Redis 的管道操作，可以一次性发送多条命令，减少网络开销。
- **事务**：Redis 提供了事务支持，通过 `MULTI` 和 `EXEC` 实现事务操作，Redigo 通过 `conn.Send` 实现事务中的命令发送。

#### Redigo 订阅发布

Redis 的 `pub/sub` 模型允许客户端订阅并发布消息，适用于实现消息通知系统。Redigo 提供了 `Subscribe` 和 `Publish` 命令进行消息的订阅和发布。

#### Stream

Redis Stream 是一种新的数据类型，适合处理大规模的消息队列，通过 `XADD`、`XREAD` 等命令进行流式数据的读写。常用于日志系统、消息队列等场景。